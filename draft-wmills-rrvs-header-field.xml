<?xml version="1.0" encoding="us-ascii"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd">

<rfc ipr="trust200902" category="info"
        docName="draft-wmills-rrvs-header-field-01">

<?rfc toc="yes" ?>
<?rfc symrefs="yes" ?>
<?rfc sortrefs="yes"?>
<?rfc strict="no" ?>
<?rfc rfcedstyle="yes"?>
<?rfc subcompact="no"?>

<front>
	<title abbrev="Require-Recipient-Valid-Since">
		The Require-Recipient-Valid-Since Header Field
	</title>

	<author initials="W. J." surname="Mills"
	        fullname="William J. Mills">

		<organization> Yahoo! Inc. </organization>

		<address>
			<email>wmills_92105@yahoo.com</email>
		</address>
	</author>

	<author initials="M. S." surname="Kucherawy"
	        fullname="Murray S. Kucherawy">

		<organization> Facebook, Inc. </organization>

		<address>
			<postal>
				<street>1 Hacker Way</street>
				<city>Menlo Park</city>
				<region>CA</region>
				<code>94025</code>
				<country>USA</country>
			</postal>
			<email>msk@fb.com</email>
		</address>
	</author>

	<date year="2013"/>

	<area>Applications</area>

	<abstract>
		<t> This document defines an email header field,
		    Require-Recipient-Valid-Since, to provide a method for senders
		    to indicate to receivers the time when the sender
		    last confirmed the ownership of the target mailbox.
		    This can be used to detect changes of mailbox ownership,
		    and thus prevent mail from being delivered to the wrong
		    party. </t>

		<t> The intended use of this header field is on automatically
		    generated messages that might contain sensitive
		    information. </t>
	</abstract>
</front>

<middle>
	<section anchor="intro" title="Introduction">
		<t> Mailbox Service Providers (MSPs) are public, often free,
		    services that provide email sending and receiving
		    capabilities to users.  Some of them have policies that
		    allow for expiration of account names when they have been
		    unused for a protracted period.  If an expired account
		    name can be reclaimed, there is a risk of delivery of
		    mail to the wrong party if some message author is unaware of
		    this change of ownership. </t>

		<t> This document defines a header field called
		    Require-Recipient-Valid-Since.  The content of this header
		    field includes an intended recipient mailbox and a
		    timestamp indicating at what point in time the
		    message author believed that mailbox to be under confirmed
		    ownership of a specific party.  If the receiving system
		    observes this field and can determine that the intended
		    recipient mailbox has changed ownership since the provided
		    timestamp, it can decline delivery, preventing possible
		    misdelivery of mail. </t>

		<t> The primary application is automatically generated messages
		    rather than user-authored content.  </t>
	</section>

	<section title="Definitions" anchor="defs">
		<t> For a description of the email architecture, consult
		    <xref target="EMAIL-ARCH"/>. </t>

		<t> The key words "MUST", "MUST NOT", "REQUIRED", "SHALL",
		    "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED",
		    "MAY", and "OPTIONAL" in this document are to be
		    interpreted as described in <xref target="KEYWORDS"/>. </t>
	</section>

	<section title="Description" anchor="descr">
		<t> The Require-Recipient-Valid-Since header field includes
		    an intended recipient coupled with a timestamp indicating
		    the most recent date and time when the message author
		    believed the destination mailbox to be under the continuous
		    ownership (see <xref target="own"/>) of a specific party.
		    Presumably there has been some confirmation process applied
		    to establish this ownership; however, the method of making such
		    determinations is a local matter and outside the scope
		    of this document. </t>

		<t> The general constraints on syntax and placement
		    of header fields in a message are defined in
		    Internet Message Format <xref target="MAIL"/>. </t>

		<t> Using Augmented Backus-Naur Form <xref target="ABNF"/>,
		    the syntax for the field is:

		    <figure><artwork>
    rrvs = "Require-Recipient-Valid-Since:" mailbox; date-time CRLF
		    </artwork></figure> </t>

		<t> "CFWS" is defined in Section 3.2.2, "date-time" is
		    defined in Section 3.3, and "mailbox" is defined in
		    Section 3.4, of <xref target="MAIL"/>. </t>

		<t> A receiving system that implements this specification
		    determines whether the named mailbox is based
		    at that receiving system, is a current intended recipient of
		    the message, and has been under continuous ownership since the
		    specified date.  If that address does not match an intended
		    local recipient (in terms of the email transaction details),
		    the header field is ignored.  Otherwise, if continuous
		    ownership since the indicated time can be established, the
		    message is delivered normally; if not, the message is
		    rejected.  Finally, when delivery is being enacted (and the
		    message is not being forwarded), the header field is
		    removed.  Expressed algorithmically:

		    <list style="numbers">
			<t> Extract the set of Require-Recipient-Valid-Since fields
			    from the message. </t>

			<t> Discard any such fields that are syntactically
			    invalid. </t>

			<t> Discard any such fields that name a role account as
			    listed in Mailbox Names For Common Services, Roles
			    And Functions <xref target="ROLES"/>. </t>

			<t> Discard any such fields for which the "mailbox" portion
			    does not match a current recipient, as listed in the
			    RCPT TO commands in the corresponding Simple Mail
			    Transfer Protocol <xref target="SMTP"/> session. </t>

			<t> For each field remaining, deterine if the named mailbox
			    has been under continuous ownership since the
			    corresponding timestamp.  If it has not, reject the
			    message. </t>

			<t> RECOMMENDED: If local delivery is being enacted,
			    remove all instances of this field prior to delivery
			    to a mailbox; if the message is being forwarded, remove
			    those instances of this header field that were not
			    discarded by steps 1-4 above. </t>
		    </list> </t>

		<t> The final step is not mandatory as not all mail handling agents
		    are capable of stripping away header fields. </t>

		<t> It is preferred that the rejection be enacted as an error
		    response to the SMTP command verb, but this is
		    not strictly necessary.  When enacting the "DATA" rejection,
		    servers use an SMTP error code (and Enhanced Mail System Status
		    Code <xref target="ESC"/>, if supported) as described in
		    <xref target="iana_esc"/>.  </t>

		<t> Implementation is expected to be transparent to non
		    participants, since they would typically ignore this header
		    field. </t>

		<t> This header field SHOULD NOT be added to a message that
		    is addressed to multiple recipients, since one address failing
		    the continuous ownership test will cause rejection of the
		    entire message.  It is presumed that an author making use of
		    this field is seeking to protect transactional or otherwise
		    sensitive data intended for a single recipient, and thus
		    generating multiple messages for each individual is
		    RECOMMENDED. </t>

		<t> If the agent generating the message uses any kind of message
		    authentication technology, the authentication SHOULD cover
		    this header field.  An agent receiving a message
		    bearing this header field that is covered by some kind of
		    authentication SHOULD NOT process it as described above if
		    the authentication does not succeed. </t>

		<t> To further obscure account details on the receiving system,
		    the receiver can ignore the header field if the address within
		    it has had one continuous owner since it was created,
		    regardless of the purported confirmation date of the
		    address. </t>
	</section>

	<section title="Discussion" anchor="disc">
		<t> It can be argued that the architecturally better decision
		    would be to introduce this capability as an extention to SMTP.
		    The exchange of meta data about the target mailbox is
		    not part of the actual message content, nor is it meta data
		    about the content.  However, if the author and the target
		    mailbox are separated by an SMTP server that does not implement
		    the SMTP extension, the check will not be able to propagate
		    to the intended receving system.  Implementing this service
		    as a header field allows the check to occur even across
		    non-participating systems, effectively tunnelling the
		    request. </t>

		<t> The presence of the intended mailbox in the field content
		    supports the case where a message bearing this header field
		    is forwarded.  The specific use case is as follows:
			<list style="numbers">
				<t> A user subscribes to a service "S" on
				    date "D" and confirms an email address at
				    the user's current location, "A"; </t>

				<t> At some later date, the user intends to
				    leave the current location, and thus creates
				    a new mailbox elsewhere, at "B"; </t>

				<t> The user replaces mailbox "A" with
				    forwarding to "B"; </t>

				<t> "S" constructs a message to "A" claiming that
				    address was valid at date "D" and sends it
				    to "A"; </t>

				<t> The receiving MTA at "A" determines that the
				    forwarding in effect was created by the
				    same party that owned the mailbox there,
				    and thus concludes the continuous ownership
				    test has been satisfied; </t>

				<t> If possible, "A" removes this header field
				    from the message, and in either case, forwards
				    it to "B"; </t>

				<t> On receipt at "B", either the header field
				    has been removed, or the header field does
				    not refer to a current envelope recipeint, and
				    in either case delivers the message. </t>
			</list> </t>

		<t> Some services generate messages with an RFC5322.To field
		    that does not contain a valid address, in order to obscure
		    the intended recipient.  For this reason, the original
		    intended recipient is included in this header field. </t>
	</section>

	<section anchor="own" title="Continuous Ownership">
		<t> Determining continuous ownership of a mailbox is entirely
		    a local matter.  In particular, the only possible answers
		    to that question are "yes", "no", and "unknown"; the action
		    to be taken in the "unknown" case is a matter of local
		    policy. </t>

		<t> For example, when control of a domain name is
		    transferred, the new domain owner may be unable to determine
		    whether the owner of the subject mailbox has been under
		    continuous ownership since the stated date if the mailbox
		    history is not also transferred (or was not previously
		    maintained). </t>

		<t> It will also be "unknown" if whatever database
		    contains mailbox ownership data is unavailable at the time a
		    message arrives for delivery.  In this case, typical
		    SMTP temporary failure handling is appropriate. </t>
	</section>

	<section title="Example" anchor="example">
		<t> In the following example, "C:" indicates data sent by an
		    SMTP client, and "S:" indicates respones by the SMTP server. 
		    Message content is CRLF terminated, though these are omitted
		    here for ease of reading.

		    <figure><artwork>
  C: [connection established]
  S: 220 server.example.com ESMTP ready
  C: HELO client.example.net
  S: 250 server.example.com
  C: MAIL FROM:&lt;sender@example.net&gt;
  S: 250 OK
  C: RCPT TO:&lt;receiver@example.com&gt;
  S: 250 OK
  C: DATA
  S: 354 Ready for message content
  C: From: Mister Sender &lt;sender@example.net&gt;
     To: Miss Receiver &lt;receiver@example.com&gt;
     Subject: Are you still there?
     Date: Fri, 28 Jun 2013 18:01:01 +0200
     Require-Recipient-Valid-Since: receiver@example.com;
       Sat, 1 Jun 2013 09:23:01 -0700

     Are you still there?
     .
  S: 550 5.7.15 receiver@example.com is no longer valid
  C: QUIT
  S: 221 So long!
		</artwork></figure></t>
	</section>

	<section anchor="privacy" title="Privacy Considerations">
		<t> This document proposes a solution to an issue that could
		    cause mail to be unintentionally delivered to the wrong
		    party. </t>
	</section>

	<section anchor="security" title="Security Considerations">
		<t> The response of a server implementing this protocol
		    can reveal information about the age of existing
		    email accounts.  The field can be ignored if the
		    claim of account existence is clearly false, such as
		    a date before the account was initially created,
		    or a date before the mailbox service was even brought
		    online. </t>
	</section>

	<section anchor="iana" title="IANA Considerations">
	  <section anchor="iana_header" title="Header Field Registration">
		<t> IANA is requested to add the following entry to the
		    Permanent Message Header Field registry, as per
		    the procedure found in <xref target="IANA-HEADERS"/>:

		<figure><artwork>
  Header field name: Require-Recipient-Valid-Since
  Applicable protocol: mail ([MAIL])
  Status: Standard
  Author/Change controller: IETF
  Specification document(s): [this document]
  Related information:
    Requesting review of any proposed changes and additions to
    this field is recommended.
		</artwork></figure> </t>
	  </section>

	  <section anchor="iana_esc" title="Enhanced Status Code Registration">
		<t> IANA is requested to register the following in the SMTP
		    Enhanced Status Codes registry:
			<figure><artwork>
   Code:               X.7.15
   Sample Text:        Mailbox owner has changed
   Associated basic status code:  5
   Description:        This status code is returned when a message is
                       received with a Require-Recipient-Valid-Since
                       field and the receiving system is able to
                       determine that the intended recipient mailbox
                       has not been under continuous ownership since
                       the specified date.
   Reference:          [this document]
   Submitter:          M. Kucherawy
   Change controller:  IESG
			</artwork></figure> </t>
	  </section>
	</section>
</middle>

<back>
	<references title="Normative References">
		<reference anchor="ABNF">
			<front>
				<title>Augmented BNF for Syntax
				       Specifications: ABNF</title>

				<author
					fullname="D. Crocker"
					initials="D."
					surname="Crocker"
					role="editor">
					<organization>
						Brandenburg InternetWorking
					</organization>
				</author>

				<author
					fullname="P. Overell"
					initials="P."
					surname="Overell">
					<organization>
						THUS plc.
					</organization>
				</author>

				<date month="January" year="2008"></date>
			</front>

			<seriesInfo name="RFC" value="5234"></seriesInfo>
		</reference>

		<reference anchor="IANA-HEADERS">
			<front>
				<title> Registration Procedures for Message
				        Header Fields </title>

				<author initials="G." surname="Klyne"
				        fullname="G. Klyne">
				</author>
				<author initials="M." surname="Nottingham"
				        fullname="M. Nottingham">
				</author>
				<author initials="J." surname="Mogul"
				        fullname="J. Mogul">
				</author>

				<date year="2004" month="September"/>
			</front>

			<seriesInfo name="BCP" value="90"/>
			<seriesInfo name="RFC" value="3864"/>
		</reference>

		<reference anchor="KEYWORDS">
			<front>
				<title>
					Key words for use in RFCs to
					Indicate Requirement Levels
				</title>

				<author fullname="Scott Bradner"
					initials="S."
					surname="Bradner">

					<organization>
						Harvard University
					</organization>
				</author>

				<date month="March" year="1997"/>
			</front>

			<seriesInfo name="BCP" value="14"/>
			<seriesInfo name="RFC" value="2119"/>
		</reference>

		<reference anchor="MAIL">
			<front>
				<title> Internet Message Format </title>

				<author initials="P." surname="Resnick"
					fullname="P. Resnick (editor)">
					<organization>
						Qualcomm, Inc.
					</organization>
				</author>

				<date month="October" year="2008" />
			</front>

			<seriesInfo name="RFC" value="5322" />
		</reference>

		<reference anchor="ROLES">
			<front>
				<title> Mailbox Names For Common Services,
				        Roles And Functions</title>

				<author
					fullname="D. Crocker"
					initials="D."
					surname="Crocker">
					<organization></organization>
				</author>

				<date month="May" year="1997"></date>
			</front>

			<seriesInfo name="RFC" value="2142"></seriesInfo>
		</reference>

		<reference anchor="SMTP">
			<front>
				<title>Simple Mail Transfer Protocol</title>

				<author
					fullname="J. Klensin"
					initials="J."
					surname="Klensin">
					<organization></organization>
				</author>

				<date month="October" year="2008"></date>
			</front>

			<seriesInfo name="RFC" value="5321"></seriesInfo>
		</reference>
	</references>

	<references title="Informative References">
		<reference anchor="EMAIL-ARCH">
			<front>
				<title> Internet Mail Architecture </title>
				<author initials="D." surname="Crocker"
				        fullname="D. Crocker">
					<organization>
						Brandenburg InternetWorking
					</organization>
				</author>
				<date month="July" year="2009" />
			</front>
			<seriesInfo name="RFC" value="5598" />
		</reference>

		<reference anchor="ESC">
			<front>
				<title> Enhanced Mail System Status Codes </title>

				<author initials="G." surname="Vaudreuil"
				        fullname="G. Vaudreuil">
					<organization>
						Lucent Technologies
					</organization>
				</author>
				<date month="January" year="2003" />
			</front>
			<seriesInfo name="RFC" value="3463" />
		</reference>
	</references>

	<section anchor="thanks" title="Acknowledgements">
		<t> Erling Ellingsen proposed the idea. </t>

		<t> Reviews and comments were provided by
		    Michael Adkins,
		    Ned Freed,
		    Gregg Stefancik,
		    Ed Zayas, (others) </t>
	</section>

</back>

</rfc>
