<?xml version="1.0" encoding="us-ascii"?>

<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
  <!ENTITY RFC2045 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.2045.xml">
  <!ENTITY RFC3864 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.3864.xml">
  <!ENTITY RFC5598 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.5598.xml">
  <!ENTITY RFC5617 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.5617.xml">
  <!ENTITY RFC6376 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6376.xml">
  <!ENTITY RFC6377 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6377.xml">
  <!ENTITY RFC6541 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6541.xml">
]>

<rfc ipr="trust200902" category="exp"
        docName="draft-kucherawy-dkim-delegate-00">

<?rfc toc="yes" ?>
<?rfc symrefs="yes" ?>
<?rfc sortrefs="yes"?>
<?rfc strict="no" ?>
<?rfc rfcedstyle="yes"?>
<?rfc subcompact="no"?>

<front>
	<title abbrev="DKIM-Delegate">
		Delegation of Signing Authority with
		DomainKeys Identified Mail (DKIM)
	</title>

	<author initials="M. S." surname="Kucherawy"
	        fullname="Murray S. Kucherawy">

		<address>
			<email>superuser@gmail.com</email>
		</address>
	</author>

	<author fullname="D. Crocker"
		initials="D." surname="Crocker">
		<organization>
			Brandenburg InternetWorking
		</organization>

		<address>
			<postal>
				<street>675 Spruce Dr.</street>
				<city>Sunnyvale</city>
				<country>USA</country>
				<code>94086</code>
			</postal>

			<phone>+1.408.246.8253</phone>
			<email>dcrocker@bbiw.net</email>
			<uri>http://bbiw.net</uri>
		</address>
	</author>

	<date year="2014"/>

	<area>Applications</area>

	<abstract>
		<t> DomainKeys Identified Mail (DKIM) permits an agent to
		    affix a digital signature to an email message, associating
		    a domain name with that message with the strength provided
		    by a cryptographic mechanism.  The domain name thus
		    attached is not, however, necessarily the same as any
		    other domain name in the message.  In particular, the
		    domain need not match the domain found in the From field
		    of the message, though this is the one users typically
		    see and is thus typically considered the most important.
		    This decoupling means DKIM cannot be used to, for example,
		    confirm that a message signed by someone other than the
		    author is actually content generated by that author. </t>

		<t> What is needed is a way for an author to indicate that a
		    signature from some third party was anticipated by the
		    author, and thus a receiver can conclude the content
		    is legitimately from that author.  This document defines
		    a new header field intended for use with DKIM that can
		    achieve that goal. </t>
	</abstract>
</front>

<middle>
	<section anchor="background" title="Background">
		<t> DomainKeys Identified Mail <xref target="RFC6376"/> defines
		    a mechanism whereby a verified domain name can be attached
		    to a message, or portion of a message, using a
		    cryptographic signature.  It does not, however, assert
		    that this domain name matches a domain name found anywhere
		    else in the message. </t>

		<t> Author Domain Signing Practices <xref target="RFC5617"/>
		    was developed as an add-on to DKIM that establishes a
		    binding between the domain name validated by DKIM and 
		    the one visible in the From: field on a message.  In
		    essence, the ADSP test is satisfied if there exists
		    on the message a DKIM signature whose domain name matches
		    the one in the From: field of the message being checked.
		    For instances where this test fails, ADSP further offers a
		    mechanism for a domain name owner to publish via the
		    Domain Name System a policy statement requesting that a
		    mail receiver prevent delivery of the message. </t>

		<t> Use of ADSP by a domain that has actual users can create
		    problems for certain common applications.  One of these
		    is mailing lists, where strict use of ADSP can be
		    disruptive to mailing list operation (see Section 5.2 of
		    <xref target="RFC6377"/>).  As a result of this limited
		    utility of ADSP, it has not resulted in widespread
		    use.  Thus, although ADSP was discussed at length during
		    its development alongside DKIM, its was recently declared
		    Historic due to lack of uptake. </t>

		<t> There are new efforts within this space that are
		    encountering similar difficulties, although they have much
		    more industry support. </t>

		<t> The issues with mailing lists and similar re-mailing
		    applications could be resolved by a mechanism by which
		    the author domain ("A") can indicate that some other domain
		    ("B") is explicitly permitted to re-mail content generated
		    by "A", and receiver can observe signaling from both "A"
		    and "B" that this relationship exists. </t>

		<t> An experimental attempt to do so appeared in
		    <xref target="RFC6541"/>.  The method presented there
		    suffers from the burden on the author domain to publish
		    those relationships a prior via the DNS.  A mechanism that
		    does not have such an external dependency is
		    preferred. </t>
	</section>

	<section anchor="defs" title="Definitions">
		<t> Numerous terms used here, especially "Author",
		    "Originator", "Receiver", and "Recipient", are defined in
		    <xref target="RFC5598"/>. </t>
	</section>

	<section anchor="descr" title="DKIM-Delegate description">
		<t> A new email header field called "DKIM-Delegate" is defined.
		    When present, it asserts an ephemeral relationship between
		    a message author and an intermediary that can be used by
		    a receiver to conclude that the intermediary legitimately
		    handled a message created by the author.  This makes it
		    possible to identify such messages separately from those
		    without such assurances, and thus the latter can be
		    treated with more skepticism. </t>

		<t> The specific mechanism is as follows:

		    <list style="numbers">
			<t> The Author generates a message in the usual
			    way and hands it to the Originator. </t>

			<t> The Originator affixes a DKIM signature that
			    includes the entire message content in the body
			    hash.  (That is, it does not use the "l="
			    tag.)  This will be referred to as the "primary
			    signature". </t>

			<t> The Originator adds a DKIM-Delegate header field
			    identifying the Author's domain.  It might also
			    identify the specific domains with which it
			    wishes to claim an ephemeral relationship; if it
			    does not, these are implicit from elsewhere
			    in the message header (see below). </t>

			<t> The Originator affixes a second DKIM signature that
			    uses an "l=" tag to sign only a portion of the
			    message body, allowing content changes, 
			    and includes only a few key header fields
			    in the header hash, including the DKIM-Delegate
			    field.  The signature also has a short
			    expiration time, using an "x=" tag.  (See
			    <xref target="disc"/> for details.)  This will
			    be referred to as the "delegation signature". </t>

			<t> The Originator sends the message.  It may or may
			    not be handled by some intermediary agents before
			    arriving at the Receiver. </t>

			<t> The Receiver attempts to validate the primary
			    signature affixed by the Originator.  If it
			    is valid and not expired, the requirements of this
			    profile are satisfied (and the algorithm terminates
			    here). </t>

			<t> The Receiver attempts to validate the delegation
			    signature affixed by the Originator.  If it
			    is not valid (or not found), the requirements
			    of this profile cannot be satisfied (and the
			    algorithm terminates here). </t>

			<t> The Receiver confirms that the delegation
			    signature included in its header hash the
			    DKIM-Delegate header field, and that the
			    "d=" value in the delegation signature matches
			    the "d=" value in the DKIM-Delegate field. </t>

			<t> If the DKIM-Delegate field included a list
			    of domain names to which delegation of re-signing
			    authority is claimed, call this set "D". </t>

			<t> If the DKIM-Delegate signature did not include such
			    a list, the Receiver collects all header fields
			    that were covered by the header hash of the
			    delegation DKIM signature and that contain
			    recipient addresses.  These can be found in that
			    signature's "h=" tag.  The obvious examples are
			    the To and Cc fields (if present).  The Receiver
			    extracts the set of domain names from the
			    collected header fields, and calls this set
			    "D". </t>

			<t> The Receiver performs normal validation checks
			    of all other DKIM signatures on the message that
			    include the entire message body in their body
			    hashes, and stores the set of domains from passing
			    signatures in set "S". </t>

			<t> If the intersection of "D" and "S" is not empty,
			    the requirements of this profile are satisfied;
			    otherwise, the requirements are not satisfied. </t>
		    </list> </t>
	</section>

	<section anchor="syntax" title="Syntax">
		<t> The content of the DKIM-Delegate header field is a 
		    tag-list as defined in Section 3.2 of
		    <xref target="RFC6376"/>.  The valid tags are:

		    <list style="hanging">
			<t hangText="d="> Author domain (plain-text; REQUIRED).
				This value names the domain of the Author,
				which is delegating signing authority to
				one or more other domains. </t>

			<t hangText="t="> Delegation target (plain-text;
				OPTIONAL).  This value is a comma-separated
				list of domain names to which the authority
				to sign on behalf of the Author domain is
				being delegated.  When not present, this list
				is inferred from the domain names present in
				the recipient fields (To, Cc) of the
				header. </t>
		    </list> </t>

		<t> As with DKIM itself, any other tag MUST be ignored. </t>
	</section>

	<section anchor="disc" title="Discussion">
		<t> The use of the primary signature ensures
		    that if the original message arrives intact, the
		    Receiver is assured of its legitimacy as having been
		    generated and sent by the Author irrespective of what
		    intermediate agents handled it. </t>

		<t> Mailing list software commonly makes adjustments to a
		    message prior to sending it to subscribers, such as
		    prepending list-identifying material to the Subject
		    field, or appending URIs and such to the message body
		    referring Receivers to further information about the list
		    itself.  This will almost always invalidate the primary
		    signature, so downstream receivers cannot be sure
		    (via DKIM, at least) where the message originated. </t>

		<t> The delegation signature always covers the DKIM-Delegate
		    field and the visible recipient fields of the message,
		    but typically does not cover any of the content.  Under
		    this profile, domains that appear in explicit delegation
		    list (or otherwise inferred from the recipient header
		    fields) are permitted to alter and re-send the content so
		    long as they also sign (and thus take responsibility for)
		    the message thus generated. </t>

		<t> The delegation signature typically covers only the
		    following header fields:
			<list style="symbols">
				<t> From (required by DKIM) </t>

				<t> To and Cc (contain Receiver addresses) </t>

				<t> Message-Id (binds the signature to a
				    specific message) </t>

				<t> Date (binds the signature to a specific
				    date) </t>

				<t> DKIM-Delegate (signals to participating
				    receivers that an ephemeral delegation of
				    signing authority is in effect) </t>
			</list> </t>

		<t> Subject, though normally covered by signatures as per
		    Section 5.4 of <xref target="RFC6376"/>, can be omitted
		    for a delegation signature if the Author anticipates
		    legitimate alteration of it by a Mediator.  See also
		    <xref target="disc_header"/>. </t>

		<t> Similarly, the delegation signature typically covers the
		    message content, but allows for legitimate Mediator
		    modifications, by including an "l=" tag in the
		    signature. </t>

		<t> The expiration time on the second Author signature
		    selected needs to be long enough to permit evaluation by
		    recipients of the re-distribution of the message.  A good
		    choice is a small number of days or even hours. </t>

		<t> This use of DKIM assumes messages sent to the list that
		    are not part of a multipart message structure, as
		    described in Multipurpose Internet Mail Extensions (MIME;
		    see <xref target="RFC2045"/>).  It may not be possible to
		    select a practical signing length for messages in other
		    than the basic message format. </t>

		<t> The delegation signature can use an "l=" value reflecting
		    the entire message as generated by the Author, or "0"
		    (zero) allowing a complete reformatting of the message. 
		    Obviously the latter grants the modifying agent
		    considerable latitude in what it will ultimately emit,
		    while the former is much more constrained.  The Originator
		    signing the message can choose whichever is more
		    appropriate for its own policies and requirements. </t>

		<section anchor="disc_header" title="Detecting Header Changes">
			<t> During the development of DKIM, consideration was
			    given to the notion of using the "z=" tag (if
			    present) to identify changes to the header made
			    in transit that render a signature invalid.
			    Ultimately it was decided that a signature should
			    be considered invalid even if analysis of the
			    content of "z=" could be used to confirm that the
			    change made in transit was innocuous.  The
			    content of "z=" was meant to be used only as a
			    debugging tool by humans. </t>

			<t> Under this use, if the Subject header field
			    was included in the header hash, it may be useful
			    to use "z=" (if present) to detect changes made
			    to the Subject field, if any.  If those changes
			    appear to be trivial, such as the insertion of a
			    prefix string at the front of the header field's
			    original value, the Author and/or delegation
			    signature could be re-attempted with the original
			    Subject field value.  If the re-attempt succeeds,
			    the verifier could decide that this profile's
			    requirements have been satisfied. </t>
		</section>
	</section>

	<section anchor="security" title="Security Considerations">
		<t> Use of this header field (and DKIM as described here)
		    amounts to an ephemeral granting of the ability for the
		    first Receivers (the Mediators named in the To and Cc
		    fields) to generate content that the ultimate Receivers
		    will consider valid on behalf of the Author.  A
		    compromised Mediator can thus replace the original content
		    in its entirety while still satisfying this profile. </t>

		<t> Section 8.2 <xref target="RFC6376"/> discusses the
		    risks of using "l=" tags when generating signatures. 
		    The "l=" tag and its implications were discussed at length
		    during the development of DKIM, and its use today is not
		    popular because it opens up the possibility of replay-type
		    exploits where legitimate, signed messages are co-opted,
		    modified, and then sent as spam. </t>

		<t> Use of "l=" here is advocated only for the specific use
		    cases this document seeks to address, namely survivability
		    of Originator signatures through modifying agents such as
		    lists.  It is believed that the exposure thus created is
		    tolerable, in particular because a second signature
		    without "l=" is required for this profile to be satisfied,
		    and the exposure created by use of "l=" is constrained by
		    a short signature expiration time. </t>
	</section>

	<section anchor="iana" title="IANA Considerations">
		<t> IANA is requested to make the following new entry in the
		    Permanent Message Header Field Names registry, per
		    <xref target="RFC3864"/>:

			<figure><artwork>
  Header field name: DKIM-Delegate
  Applicable protocol: mail ([RFC5322])
  Status: Experimental
  Author/Change controller: IETF
  Specification document(s): [this document]
  Related information:
    Requesting review of any proposed changes and additions to
    this field is recommended.
			</artwork></figure></t>
	</section>
</middle>

<back>
	<references title="Normative References">
		&RFC3864;
		&RFC6376;
	</references>

	<references title="Informative References">
		&RFC2045;
		&RFC5598;
		&RFC5617;
		&RFC6377;
		&RFC6541;
	</references>

	<section anchor="thanks" title="Acknowledgments">
		<t> The authors wish to acknowledge
		    Barry Leiba,
		    (other names)
		    and
		    (other name)
		    for their comments during the development of this
		    document. </t>
	</section>
</back>

</rfc>
